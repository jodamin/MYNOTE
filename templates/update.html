<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Your Note
    </title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Check theme preference immediately to prevent white flash -->
    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
</head>

<body>
    <h1>Update Your Note</h1>
    <form action="/update/{{ note.id }}" method="POST">
        <textarea name="content" placeholder="Update your note here..." required>{{ note.content }}</textarea>

        <div class="button-group">
            <button type="submit" class="button-update">Update</button>
            <a href="/" class="button-cancel">Cancel</a>
        </div>
    </form>

    <!-- <script>
        const tx = document.getElementsByTagName("textarea");
        for (let i = 0; i < tx.length; i++) {
            function OnInput() {
                this.style.height = "auto";
                this.style.height = (this.scrollHeight) + "px";
            }

            tx[i].setAttribute("style", "height:" + (tx[i].scrollHeight) + "px;overflow-y:hidden;");
            tx[i].addEventListener("input", OnInput, false);

            tx[i].addEventListener("keydown", function (e) {
                if (e.key === "Enter" && !e.shiftKey) {
                    e.preventDefault();
                    this.form.submit();
                }
            });
        }
    </script> -->

    <!-- Add a script to modify the textarea to auto-resize based on its content -->
    <script>
        const textareas = document.getElementsByTagName("textarea");

        for (let i = 0; i < textareas.length; i++) {
            const tx = textareas[i];

            // Function to dynamically adjust height based on content
            function autoResize() {
                tx.style.height = "auto"; // Reset height to recalculate accurately
                tx.style.height = tx.scrollHeight + "px"; // Set height based on scrollHeight
            }

            // 1. Initial call to adjust height on page load (useful for existing notes)
            autoResize();

            // 2. Trigger auto-resize on every user input
            tx.addEventListener("input", autoResize);

            // 3. Submit form on 'Enter' key, but allow new lines with 'Shift + Enter'
            tx.addEventListener("keydown", function (e) {
                if (e.key === "Enter" && !e.shiftKey) {
                    e.preventDefault(); // Prevent the default new line behavior
                    this.form.submit(); // Trigger form submission
                }
            });
        }
    </script>

    <!-- Scripts Js for switch theme -->
    <script>
        const toggleBtn = document.getElementById('theme-toggle');
        const html = document.documentElement;

        // 1. Check for saved theme preference in localStorage on page load
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            html.setAttribute('data-theme', 'dark'); // Apply the dark theme attribute
            if (toggleBtn) toggleBtn.textContent = '‚òÄÔ∏è Light Mode'; // Update button text
        }

        // 2. Add event listener to handle the theme toggle
        if (toggleBtn) {
            toggleBtn.addEventListener('click', () => {
                const currentTheme = html.getAttribute('data-theme');

                if (currentTheme === 'dark') {
                    html.removeAttribute('data-theme'); // Revert to light mode
                    localStorage.setItem('theme', 'light'); // Save the preference
                    toggleBtn.textContent = 'üåô Dark Mode';
                } else {
                    html.setAttribute('data-theme', 'dark'); // Switch to dark mode
                    localStorage.setItem('theme', 'dark'); // Save the preference
                    toggleBtn.textContent = '‚òÄÔ∏è Light Mode';
                }
            });
        }
    </script>
</body>

</html>