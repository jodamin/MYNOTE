<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Note App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <!-- Check theme preference immediately to prevent white flash -->
    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        })();
    </script>
</head>

<body>
    <h1>Your Notebook here, {{ name }}</h1>
    <button id="theme-toggle">üåô Dark Mode</button>
    <a href="/welcome" class="change-name">Change Your Name</a>
    <!-- <p>This is my first personal project :D</p> -->


    <!-- Add input for text-->
    <form action="/add" method="POST">
        <h3>Writing here</h3>
        <textarea name="content" placeholder="Feel free to write your story..." required></textarea>
        <button type="submit">Save</button>
    </form>

    <!-- Add a script to modify the textarea to auto-resize based on its content -->
    <script>
        const textareas = document.getElementsByTagName("textarea");

        for (let i = 0; i < textareas.length; i++) {
            const tx = textareas[i];

            // Function to dynamically adjust height based on content
            function autoResize() {
                tx.style.height = "auto"; // Reset height to recalculate accurately
                tx.style.height = tx.scrollHeight + "px"; // Set height based on scrollHeight
            }

            // 1. Initial call to adjust height on page load (useful for existing notes)
            autoResize();

            // 2. Trigger auto-resize on every user input
            tx.addEventListener("input", autoResize);

            // 3. Submit form on 'Enter' key, but allow new lines with 'Shift + Enter'
            tx.addEventListener("keydown", function (e) {
                if (e.key === "Enter" && !e.shiftKey) {
                    e.preventDefault(); // Prevent the default new line behavior
                    this.form.submit(); // Trigger form submission
                }
            });
        }
    </script>

    <!-- Display the notes -->
    <h3>My Notes</h3>
    <ul>
        {% for note in notes %}
        <li>
            <div class="note-content">{{ note.content }}</div>

            <div class="note-actions">
                <a href="/update/{{ note.id }}" class="button-change">Change</a>
                <a href="/delete/{{ note.id }}" class="button-delete">Delete</a>
            </div>
        </li>
        {% endfor %}
    </ul>

    <!-- Scripts Js for switch theme -->
    <script>
        const toggleBtn = document.getElementById('theme-toggle');
        const html = document.documentElement;

        // 1. Check for saved theme preference in localStorage on page load
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            html.setAttribute('data-theme', 'dark'); // Apply the dark theme attribute
            if (toggleBtn) toggleBtn.textContent = '‚òÄÔ∏è Light Mode'; // Update button text
        }

        // 2. Add event listener to handle the theme toggle
        if (toggleBtn) {
            toggleBtn.addEventListener('click', () => {
                const currentTheme = html.getAttribute('data-theme');

                if (currentTheme === 'dark') {
                    html.removeAttribute('data-theme'); // Revert to light mode
                    localStorage.setItem('theme', 'light'); // Save the preference
                    toggleBtn.textContent = 'üåô Dark Mode';
                } else {
                    html.setAttribute('data-theme', 'dark'); // Switch to dark mode
                    localStorage.setItem('theme', 'dark'); // Save the preference
                    toggleBtn.textContent = '‚òÄÔ∏è Light Mode';
                }
            });
        }
    </script>
</body>

</html>